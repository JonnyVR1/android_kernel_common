Revision: dfb0e31dcd196c899929b7b7482eebec88d71215
Patch-set: 1
File: android/configs/android-base.cfg

3
Fri Apr 04 18:56:22 2014 +0000
Author: JP Abgrall <1005480@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 19c5035d_fecb108c
Bytes: 149
Add
   # CONFIG_LSM_MMAP_MIN_ADDR is not set

so that any other kernels that we don't control will see a warning when the merge the android-base.cfg.

3
Fri Apr 04 19:07:31 2014 +0000
Author: Stephen Smalley <1010111@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 19c5035d_fecb108c
UUID: 198a632f_ad5cfdb5
Bytes: 332
Seems to produce a warning even with the fixed defconfig because the final .config defines it to the default value in security/Kconfig, based on architecture.

Value requested for CONFIG_LSM_MMAP_MIN_ADDR not in final .config

Requested value:  # CONFIG_LSM_MMAP_MIN_ADDR is not set

Actual value:     CONFIG_LSM_MMAP_MIN_ADDR=32768

3
Fri Apr 04 20:01:01 2014 +0000
Author: JP Abgrall <1005480@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 198a632f_ad5cfdb5
UUID: 999e536b_14e0ba7b
Bytes: 2526
I see your point about the warning showing up when everything should be ok.
merge_config.sh should handle something like:
 SED_CONFIG_THAT_SHOULD_BE_DEFAULT_IN_BASE_FILE_EXP="s/^\(# \)\{0,1\}\(CONFIG_[a-zA-Z0-9_]*\)!.*should be non-existant in base.*/\2/p"


* With the "# ... is not set"

 priv_manta $ scripts/kconfig/merge_config.sh arch/arm/configs/manta_defconfig android/configs/android-base.cfg android/configs/android-recommended.cfg
   Using arch/arm/configs/manta_defconfig as base
   Merging android/configs/android-base.cfg
   Value of CONFIG_LSM_MMAP_MIN_ADDR is redefined by fragment android/configs/android-base.cfg:
   Previous value: CONFIG_LSM_MMAP_MIN_ADDR=4096
   New value: # CONFIG_LSM_MMAP_MIN_ADDR is not set

   Merging android/configs/android-recommended.cfg
   scripts/kconfig/conf --alldefconfig Kconfig
   #
   # configuration written to .config
   #
   Value requested for CONFIG_LSM_MMAP_MIN_ADDR not in final .config
   Requested value:  # CONFIG_LSM_MMAP_MIN_ADDR is not set
   Actual value:     CONFIG_LSM_MMAP_MIN_ADDR=32768

 $ make savedefconfig
   scripts/kconfig/conf --savedefconfig=defconfig Kconfig
 $ grep CONFIG_LSM_MMAP_MIN_ADDR .config defconfig
   .config:CONFIG_LSM_MMAP_MIN_ADDR=32768  <<< happiness.

 
* And without the "# ... is not set"

 $ scripts/kconfig/merge_config.sh arch/arm/configs/manta_defconfig android/configs/android-base.cfg android/configs/android-recommended.cfg
   Using arch/arm/configs/manta_defconfig as base
   Merging android/configs/android-base.cfg
   Merging android/configs/android-recommended.cfg
   scripts/kconfig/conf --alldefconfig Kconfig
   #
   # configuration written to .config
   #

 $ make savedefconfig
   scripts/kconfig/conf --savedefconfig=defconfig Kconfig
 $ grep CONFIG_LSM_MMAP_MIN_ADDR .config defconfig
   .config:CONFIG_LSM_MMAP_MIN_ADDR=4096  <<< meh-ness.
   defconfig:CONFIG_LSM_MMAP_MIN_ADDR=4096  <<< meh-ness.

 
* better merge_config?
  diff --git a/scripts/kconfig/merge_config.sh b/scripts/kconfig/merge_config.sh
index 974d5cb..70a000d 100755
--- a/scripts/kconfig/merge_config.sh
+++ b/scripts/kconfig/merge_config.sh
@@ -72,0 +73 @@ SED_CONFIG_EXP="s/^\(# \)\{0,1\}\(CONFIG_[a-zA-Z0-9_]*\)[= ].*/\2/p"
+SED_CONFIG_WANTED_DEFAULT_IN_BASE_EXP="s/^# \(CONFIG_[a-zA-Z0-9_]*\) .*should be default.*//p"
@@ -118 +119 @@ make KCONFIG_ALLCONFIG=$TMP_FILE $ALLTARGET
-for CFG in $(sed -n "$SED_CONFIG_EXP" $TMP_FILE); do
+for CFG in $(sed "$SED_CONFIG_WANTED_DEFAULT_IN_BASE_EXP" $TMP_FILE | sed -n "$SED_CONFIG_EXP"); do

89:0-89:38
Thu Apr 03 22:24:54 2014 +0000
Author: JP Abgrall <1005480@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 59b3fbf9_5705ccdd
Bytes: 243
Are the netfilter changes required?

In the past, some netfilters conntrack helpers were broken and would lead to dropped packets. E.g. SIP can't handle ipv6 fragments and tells conntrack to NF_DROP.
Have these setting been tested on a device?

89
Thu Apr 03 22:55:11 2014 +0000
Author: Stephen Smalley <1010099@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 59b3fbf9_5705ccdd
UUID: 79d51fff_a3798453
Bytes: 265
Not absolutely required (but already enabled in e.g. hammerhead_defconfig).  I would have put them in -recommended except that all of the other NETFILTER options were already in -base.  Should only come into play if you configure iptables SECMARK/CONNSECMARK rules.

89
Fri Apr 04 12:20:18 2014 +0000
Author: Stephen Smalley <1010111@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 79d51fff_a3798453
UUID: f9966f57_cc0eaf4e
Bytes: 513
In addition to hammerhead, the options are also already enabled in manta_defconfig, flo_defconfig, mako_defconfig and tegra3_android_defconfig, so these have been enabled in actual devices for a while (even back in -jb-mr2 branches in addition to the kitkat branches).  Not enabled in goldfish_armv7_defconfig presently, should likely make that one consistent.
If you'd prefer them moved to -recommended, I can do that; it just seemed out of place to have all the NETFILTER options except for those here in -base.

